<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">




    <meta name="keywords" content=""/>



    <meta name="description" content=""/>


<meta name="Robots" content="all">


    <title>Augustxuesong</title>


<link rel="icon" href="/images/favicon.ico">

<link rel="stylesheet" href="/css/font-awesome.min.css">


<link rel="stylesheet" href="/css/atom-one-dark.css">


<link rel="stylesheet" href="/css/style.css">


<script src="/js/highlight.min.js"></script>

<meta name="generator" content="Hexo 5.2.0"></head>
<body>
    <div class="main-container">
        <header class="header">
    <div class="global-width">
        <nav class="nav-box">
            
                <a class="nav-item" href="/"
                
                >Home</a>
            
                <a class="nav-item" href="/resume"
                
                >Resume</a>
            
                <a class="nav-item" href="/mood"
                
                   target="_blank"
                
                >Mood</a>
            
                <a class="nav-item" href="/amusement/tetris"
                
                   target="_blank"
                
                >Amusement</a>
            
                <a class="nav-item" href="/about"
                
                >About</a>
            
        </nav>
    </div>
</header>

        <section class="content global-width">
            <div class="main">
                
    
        <article class="box post post-item">
            <div class="post-title"><a href="/2020/09/03/Dockerfile%E6%9E%84%E5%BB%BA%E9%95%9C%E5%83%8F/">Docker Dockerfile</a></div>
            <div class="post-meta">
                
                <i class="fa fa-calendar"></i> <time>2020-09-03</time>
                <span class="dotted">|</span>
                <i class="fa fa-user"></i> 
            </div>

            <div class="post-excerpt">
                <a href="/2020/09/03/Dockerfile%E6%9E%84%E5%BB%BA%E9%95%9C%E5%83%8F/">
                    <p>
                        
                            Dockerfile什么是 Dockerfile？Dockerfile 是一个用来构建镜像的文本文件，文本内容包含了一条条构建镜像所需的指令和说明。
一.Dockerfile基本结构一般的，Dockerfile 分为四部分：基础镜像信息、维护者信息、镜像操作指令和容器启动时执行指令
123456789101112131415161718192021222324# This Nuxt.js Dockerfile# FROM MAINTAINER Xuest# Base images 基础镜像FROM registry.ihdou.com/node:10.15.3-alpine#MAINTAINER 维护者信息MAINTAINER Xuest #ENV 设置环境变量ENV NODE_ENV=productionENV HOST 0.0.0.0#RUN 执行以下命令 RUN mkdir -p /social-statics-app#COPY COPY . /social-statics-app#WORKDIR 相当于cdWORKDIR /social-statics-app#EXPOSE 映射端口EXPOSE 3000RUN npm installRUN npm rebuild node-sassRUN npm run buildRUN npm cache clean --force#CMD 运行以下命令CMD [&quot;npm&quot;, &quot;start&quot;]

1、FROM : 指定基础镜像，要在哪个镜像建立
格式为 FROM &lt;image&gt; 或FROM &lt;image&gt;:&lt;tag&gt; 。
第一条指令必须为 FROM 指令。**定制的镜像都是基于 FROM 的镜像，这里的 image就是定制需要的基础镜像。后续的操作都是基于 image。
2、MAINTAINER：指定维护者信息
格式为 MAINTAINER &lt;name&gt;
3、RUN：在镜像中要执行的命令
格式为 RUN &lt;command&gt; 或 RUN [&quot;executable&quot;, &quot;param1&quot;, &quot;param2&quot;]，前者将在 shell 终端中运行命令，即 /bin/bash -c ；后者则使用 exec 执行。指定使用其它终端可以通过第二种方式实现，例如 RUN [“/bin/bash”, “-c”,”echo hello”] 。
4、WORKDIR：指定当前工作目录，相当于 cd
格式为 WORKDIR /path/to/workdir
5、EXPOSE：指定容器要打开的端口
格式为 EXPOSE &lt;port&gt; [&lt;port&gt;...]，告诉 Docker 服务端容器暴露的端口号，供互联系统使用。在启动容器时需要通过 -P，Docker 主机会自动分配一个端口转发到指定的端口。
6、ENV：定义环境变量
格式为 ENV &lt;key&gt; &lt;value&gt; 。 指定一个环境变量，会被后续 RUN 指令使用，并在容器运行时保持。
ENV PATH /usr/local/nginx/sbin:$PATH
7、COPY 
复制本地主机的 （为 Dockerfile 所在目录的相对路径）到容器中的
8、ADD
相当于 COPY，但是比 COPY 功能更强大
格式为 ADD &lt;src&gt; &lt;dest&gt;，该命令将复制指定的 到容器中的 。 其中 可以是Dockerfile所在目录的一个相对路径；也可以是一个 URL；还可以是一个 tar 文件，复制进容器会自动解压。
9、VOLUME
挂载目录 格式为VOLUME [&quot;/data&quot;]，创建一个可以从本地主机或其他容器挂载的挂载点，一般用来存放数据库和需要保持的数据等。
10、USER
格式为 USER daemon，指定运行容器时的用户名或 UID，后续的 RUN 也会使用指定用户。当服务不需要管理员权限时，可以通过该命令指定运行用户。并且可以在之前创建所需要的用户，例如： RUN useradd -s /sbin/nologin -M www。
11、ENTRYPOINT
ENTRYPOINT [“executable”, “param1”, “param2”] ENTRYPOINT command param1 param2 （shell中执行）
配置容器启动后执行的命令，并且不可被 docker run 提供的参数覆盖。每个 Dockerfile 中只能有一个 ENTRYPOINT ，当指定多个时，只有最后一个起效。
12、CMD
CMD [“executable”,”param1”,”param2”] 使用 exec 执行，推荐方式；CMD command param1 param2 在 /bin/bash 中执行，提供给需要交互的应用；CMD [“param1”,”param2”] 提供给 ENTRYPOINT 的默认参数；指定启动容器时执行的命令，每个 Dockerfile 只能有一条 CMD 命令。如果指定了多条命令，只有最后一条会被执行。如果用户启动容器时候指定了运行的命令，则会覆盖掉 CMD 指定的命令
13、ONBUILD
格式为 ONBUILD [INSTRUCTION]，在构建本镜像时不生效，在基于此镜像构建镜像时生效。配置当所创建的镜像作为其它新创建镜像的基础镜像时，所执行的操作指令。
注意：
ENTRYPOINT 和 CMD 的区别：ENTRYPOINT 指定了该镜像启动时的入口，CMD 则指定了容器启动时的命令，当两者共用时，完整的启动命令像是 ENTRYPOINT + CMD 这样。使用 ENTRYPOINT 的好处是在我们启动镜像就像是启动了一个可执行程序，在 CMD 上仅需要指定参数；另外在我们需要自定义 CMD 时不容易出错。
使用 CMD 的 Dockerfile：
1[root@sta2 test]# cat Dockerfile FROM mysql CMD [&quot;echo&quot;,&quot;test&quot;]

使用 ENTRYPOINT 的 Dockerfile
1[root@sta2 entrypoint]#  cat  Dockerfile FROM mysql ENTRYPOINT [&quot;echo&quot;,&quot;test&quot;]

结论：ENTRYPOINT 不能覆盖掉执行时的参数，CMD 可以掉覆盖默认的参数。
demo
Jar例子：
FROM registry.ihdou.com/java8LABEL maintainer XuestADD social-search-server-1.0.0-SNAPSHOT.jar search.jarEXPOSE 10014 19997ENTRYPOINT [“java”,”-jar”,”search.jar”]
VUE Nuxt例子：
FROM registry.ihdou.com/node:10.15.3-alpineMAINTAINER XuestENV NODE_ENV=productionENV HOST 0.0.0.0RUN mkdir -p /social-statics-appCOPY . /social-statics-appWORKDIR /social-statics-appEXPOSE 3000RUN npm installRUN npm rebuild node-sassRUN npm run buildRUN npm cache clean –forceCMD [“npm”, “start”]
VUE静态：
FROM registry.ihdou.com/tool/nginxRUN mkdir /usr/share/nginx/html/v4manageCOPY nginx.conf /etc/nginx/nginx.confCOPY ./v4manage /usr/share/nginx/html/v4manageEXPOSE 80
&lt;覆盖容器nginx配置&gt;
nginx根目录：/usr/share/nginx/html/
nginx配置地址：/etc/nginx/nginx.conf
        server &#123;
                listen       80;
                server_name  localhost;
                root    /usr/share/nginx/html/v4manage/;
                location / &#123;
                        try_files $uri $uri/ @router;
                        index  index.html index.htm;
                &#125;
                location @router &#123;
                        rewrite ^.*$ /index.html last;
                &#125;
        &#125;
二.创建镜像1、使用Dockerfile构建镜像
docker build -t v4manage .  
2.给镜像打标签
docker tag v4manage  192.168.102.78/4.0/ v4manage 
3.Push仓库
docker push 192.168.102.78/4.0/ v4manage
[root@k8s-master harbor]# docker tag 192.168.102.78/v4manage 192.168.102.78/4.0/v4manage[root@k8s-master harbor]# docker push 192.168.102.78/4.0/v4manageThe push refers to repository [192.168.102.78/4.0/v4manage]518ec4362654: Pushedba2c6d9de847: Pushed6f40d5797506: Pushed7e914612e366: Pushedf790aed835ee: Pushed850c2400ea4d: Pushed7ccabd267c9f: Pushedf5600c6330da: Pushedlatest: digest: sha256:9f920ab7c9e5f5b5f9673b013b2b68193ca80c0a5236d7c72484e473abe3f659 size: 1987

                        
                    </p>
                </a>
            </div>

            
        </article>
    



            </div>
            <div class="aside">
    
        <div class="box widget">
    <div class="introduction">
        <p><img src="/images/avatar.jpg" alt="head-sculpture" /></p>
        <p class="name">
            xuesongtan
        </p>
        <p class="slogan">流连矣 忘景幻云催 峦栈醺醺说旧梦 重山迟迟映霞辉 向晚共邀归</p>
    </div>
</div>
    
        
<div class="box widget">
    <div class="title">Recent</div>
    <ul class="item-box">
        
            
                <li><a href="/2020/12/03/Docker%E6%95%99%E7%A8%8B%E8%AE%B2%E8%A7%A3/">Docker 教程讲解</a></li>
            
        
            
                <li><a href="/2020/11/03/Docker%E7%A7%81%E6%9C%89%E4%BB%93%E5%BA%93%E6%90%AD%E5%BB%BA/">Docker 搭建私有仓库</a></li>
            
        
            
                <li><a href="/2020/10/03/Docker%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/">Docker 命令大全</a></li>
            
        
            
                <li><a href="/2020/09/03/Dockerfile%E6%9E%84%E5%BB%BA%E9%95%9C%E5%83%8F/">Docker Dockerfile</a></li>
            
        
            
                <li><a href="/2020/08/03/Elasticsearch%E9%9B%86%E7%BE%A4/">Elasticsearch集群搭建</a></li>
            
        
            
                <li><a href="/2020/07/03/Java%E5%A4%9A%E7%BA%BF%E7%A8%8B/">多线程讲解</a></li>
            
        
            
                <li><a href="/2020/06/03/Maven%E7%9F%A5%E8%AF%86%E5%BA%93/">Maven知识库</a></li>
            
        
            
                <li><a href="/2020/06/03/Redis%E9%9B%86%E7%BE%A4%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/">Redis集群安装部署</a></li>
            
        
    </ul>
</div>

    
        
    
        
  <div class="box widget">
    <div class="title">Archives</div>
    <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">2020-12</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">2020-11</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">2020-10</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">2020-09</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">2020-08</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">2020-07</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">2020-06</a><span class="archive-list-count">2</span></li></ul>
  </div>

    
        
    
</div>
        </section>
        <footer class="footer">
    <div class="global-width footer-box">
        <div class="copyright">
            <span>Copyright &copy; 2019</span>
            <span class="dotted">|</span>
            <span>Powered by <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a></span>
            <span class="dotted">|</span>
            <span>Theme by <a href="javascript:">Loren</a></span>
            <span class="dotted">|</span>
            <span><a target="_blank" rel="noopener" href="http://www.beian.miit.gov.cn">浙ICP备18016660号-1</a></span>
        </div>
    </div>
</footer>
    </div>

<script>
    hljs.initHighlightingOnLoad();
</script>
</body>
</html>